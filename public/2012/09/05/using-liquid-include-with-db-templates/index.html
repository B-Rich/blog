
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Using Liquid `include` with DB templates - Nicol치s Hock Isaza</title>
  <meta name="author" content="Nicol치s Hock Isaza">

  
  <meta name="description" content="I am working on a new application that will use some Liquid templates to
allow our clients to edit some templates. We will store these templates in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.nhocki.com/2012/09/05/using-liquid-include-with-db-templates">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Nicol치s Hock Isaza" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25223573-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <header role="banner"><hgroup>
  <h1><a href="/">Nicol치s Hock Isaza</a></h1>
  
    <h2>Ruby, Rails, Programming and Random Thoughts</h2>
  
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Using Liquid `include` With DB Templates</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-05T17:37:00-04:00" pubdate data-updated="true">Sep 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I am working on a new application that will use some <a href="http://liquidmarkup.org/" title="Liquid Markup">Liquid</a> templates to
allow our clients to edit some templates.</p>

<p>We will store these templates in the Database, load them, parse them and render
them. So far, no magic.</p>

<p>But, I needed to have some &#8220;partials&#8221; for these. I wanted some common elements
(like image galleries) to be available for the client to use in that specific
template.</p>

<p>The way you normally accomplish this is by using an <code>include</code> tag, but I needed
a little bit more control. Not all the clients will have the same partials and
I also wanted the clients to be able to edit these partials.</p>

<p>So after reading the <a href="https://github.com/Shopify/liquid/blob/master/lib/liquid/tags/include.rb#L49-61" title="Liquid include source code">Liquid source code</a>, I found a really easy way to do
this.</p>

<p>You just need an object that responds to <code>read_template_file</code> and it can take
1 or 2 arguments (please, go for 2). This method must return the Liquid <strong>source</strong>
of the partial (not a parsed template).</p>

<p>So, here&#8217;s a really simple one that will work:</p>

<div><script src='https://gist.github.com/3645632.js?file='></script>
<noscript><pre><code># Class to be used as a Liquid File System for the `include` tag
class LiquidTemplateSystem
  attr_reader :user

  def initialize(user)
    @user = user
  end

  # Return a valid liquid template string
  def read_template_file(template_path, context)
    user.partials.find_by_name(template_path).liquid_source
  end
end


# In the view:
# This `template` has an {% include %} tag.
&lt;%= template.render(obj, registers: LiquidTemplateSystem.new(user)) %&gt;</code></pre></noscript></div>


<h2>Default FileSystem</h2>

<p>You could also set the default <code>FileSystem</code> with
<code>Liquid::Template.file_system = MyNewFileSystem.new</code>. This may be useful if you
want the partials to be shared on the database but not different for every user.</p>

<h2>Any other way?</h2>

<p>Even though I find this to be <em>really</em> easy, another way may exist. If you know
of a better way to do this, please <a href="https://twitter.com/nhocki">let me know</a>.</p>
</div>


  <footer>
    <p class="meta">
      

<span class="categories">
  Posted under: 
  
    <a class='category' href='/blog/categories/liquid/'>liquid</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/rails-views/'>rails views</a>
  
</span>


    </p>
    <p class="meta posts">
      
        <a class="basic-alignment left" href="/2012/07/26/seriously-just-do-it/" title="Previous Post: Seriously just do it">&laquo; Seriously just do it</a>
      
      
    </p>
  </footer>
</article>

</div>

    </div>
  </div>
  <footer role="contentinfo"><p class="site-end-note">
  You can follow me on Twitter <a href="https://twitter.com/nhocki">@nhocki</a>,
  find me on Github as <a href="https://github.com/nhocki">nhocki</a> or
  write me an email at <a href="mailto:nhocki@gmail.com">nhocki@gmail.com</a>
</p>

<p class="site-end-note">You should also suscribe to my <a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS Feed</a></p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
