
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Nicolás Hock Isaza</title>
  <meta name="author" content="Nicolás Hock Isaza">

  
  <meta name="description" content="I have been developing a new app using a lot of decorators and presenters. I&#39;ve been highly influenced by Avdi (both his blog and his Objects in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.nhocki.com/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Nicolás Hock Isaza" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "419f9d9e-b149-4b3e-acb8-ce56b4c7da06"}); </script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25223573-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <header role="banner"><hgroup>
  <h1><a href="/">Nicolás Hock Isaza</a></h1>
  
    <h2>Ruby, Rails, Programming and Random Thoughts</h2>
  
</hgroup>

</header>
  <div id="main">
    <div class="blog-index">
  
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/31/thoughts-on-decorators-and-presenters/">Thoughts on Decorators & Presenters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-31T18:12:00-05:00" pubdate data-updated="true">Jan 31<span>st</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have been developing a new app using a lot of <a href="http://blog.nhocki.com/2012/01/10/simple-presenters--decorators-on-rails/">decorators and presenters</a>. I&#39;ve been highly influenced by <a href="http://about.avdi.org/">Avdi</a> (both his <a href="http://avdi.org/devblog/">blog</a> and his <a href="http://avdi.org/devblog/2011/11/15/early-access-beta-of-objects-on-rails-now-available-2/">Objects in Rails book</a>) and <a href="http://steveklabnik.com">Steve Klabnik</a>, but now I have a problem. My decorators are starting to get big. I&#39;ll have to use <code>concerns</code> for that. Expect another post about it (maybe).</p>

<p><strong>I want to warn you that I am not by any means an expert on the subject. So I&#39;m more than open to any feedback you can give me.</strong></p>

<blockquote>
<p>All presenters are decorators, but not all decorators are presenters.</p>

<p>A decorator is a class that adds some sort of functionality to another
class. A presenter is a class that adds some sort of presentation
formatting functionality to another class.</p>

<p><a href="https://groups.google.com/forum/#!msg/objects-on-rails/htAopf3k_dM/qJMq6QAfMvsJ">Steve Klabnik</a></p>
</blockquote>

<p>I think that what a decorator <em>should</em> do is give a standard API for the processed data stored somewhere (probably a database). I don&#39;t think a decorator should be in charge of the markup of the presented data. For me, it makes no sense that the decorator (that is processed data for me), knows <em>how</em> it is being shown to the user.</p>

<p>That said, I think the <strong>same</strong> decorator should be used to build the JSON response and the HTML response. The HTML markup and JSON structure are <em>just</em> \&#39;markup\&#39;. So, they can be treated as templates.</p>

<h3 id="toc_65">So, where do the logic in the template goes?</h3>

<p>I had this discussion with a <a href="http://mheroin.com/">friend</a>, and he asked me that, with this approach, how would he add elements to a view depending on a condition, for example, the famous \&#39;***You are logged in as nhocki***\&#39; if there&#39;s a user logged in.</p>

<p>I think this should be created inside helper methods that takes a block. Inside that block you can use the <strong>decorator</strong> methods to show the needed data. You can use those methods in your JSON builder too (try out the new <a href="https://github.com/rails/jbuilder">Jbuilder</a>). You could bundle up these methods and re-use them in your projects too.  </p>

<p>Here&#39;s an example:</p>

<div><script src='https://gist.github.com/1714913.js?file='></script>
<noscript><pre><code># app/models/user.rb
#
# User model has name &amp; username
#
# Only the username is required (signup with Github for example)
class User &lt; ActiveRecord::Base
  validates :username, presence: true
end



# app/decorators/user_decorator.rb
#
# Let's use the Draper gem for the decorators
class UserDecorator &lt; ApplicationDecorator
  decorates :user

  def display_name
    user.name.presence || user.username
  end

  # Formatting the data is OK. I'm against adding the markup
  def salary
    h.number_to_currency(user.salary)
  end
end


# app/views/users/index.html.erb

# current_user is a presenter
&lt;%= logged_in_area do %&gt;
  You are logged in as &lt;%= current_user.display_name %&gt;
&lt;% end %&gt;

# viewing @some_users's profile (which is also a presenter)
&lt;%= admin_area do %&gt;
  &lt;span class=&quot;salary&quot;&gt;&lt;%= @some_user.salary %&gt;&lt;/span&gt;
&lt;% end %&gt;


# app/helpers/application_helpers.rb
#
# We all hate helpers, but this time, they're useful.
def admin_area(&amp;block)
  content_tag(:div, capture(&amp;block), class: 'admin') if current_user.admin?
end</code></pre></noscript></div>

<h3 id="toc_66">Maybe I have the names wrong</h3>

<p>As I mentioned before, I&#39;m no expert on design patterns. And I&#39;m pretty <em>new</em> to presenters and decorators. So, maybe my approach has a different name. I don&#39;t really care how this is called, I feel it&#39;s a more natural approach and it keeps the template and the processed data in different parts.</p>

<h3 id="toc_67">Please provide feedback</h3>

<p>It is also possible that I have it all wrong, that&#39;s why I&#39;m really interested in your opinion. I&#39;m eager to learn about everything from anyone, so I would love to have some feedback about this. You can post a comment below or send me a message on <a href="http://twitter.com/nhocki">twitter</a>.</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/23/from-tumblr-to-octopress/">From Tumblr to Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-23T00:00:00-05:00" pubdate data-updated="true">Jan 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wrote an article yesterday about URL design and I spent about an hour fighting with <a href="http://tumblr.com/">Tumblr</a> to format my <code>code inside a pre (or code) tag</code>. I knew I was done with them. Today, I&#39;m giving <a href="http://octopress.org/">Octopress</a> a try. I honestly wanted to try <a href="http://jekyllrb.com/">Jekyll</a> but I was really lazy to code my HTML. So, for now, I&#39;m welcoming Octopress.</p>

<p>I really love the fact that I can write in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, it&#39;s really powerful yet simple that makes me focus on writing and not formatting. I know I can use Markdown in Tumblr but I don&#39;t have Textmate there, so this is a big +1 for Jekyll/Octopress.</p>

<h2 id="toc_63">Moving Posts From Tumblr</h2>

<p>There&#39;s a <a href="https://github.com/mojombo/jekyll/wiki/Blog-Migrations">great script</a> to move posts from Tumblr. They&#39;ll even be downloaded as markdown, but I still had to edit them to add the Gist snippets. Thankfully I don&#39;t have a lot of posts so it didn&#39;t took a lot.</p>

<h2 id="toc_64">Deploying</h2>

<p>I&#39;ve deployed my blog to <a href="http://heroku.com">Heroku</a> now. It was supposed to be really simple. It was, after I realized that the <code>public</code> folder is ignored by the git. I spent an hour of my life there :-( !</p>

<pre>Remove the public folder from your .gitignore</pre>

<p>I&#39;ll probably post more about Octopress when I get to know it better. There are a bunch of plugins and stuff that may be useful, or maybe, it&#39;ll suck and I&#39;ll have to go and find something else!</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/22/beautiful-urls-in-rails-the-easy-way/">Beautiful URLs in Rails. The Easy Way.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-22T00:00:00-05:00" pubdate data-updated="true">Jan 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#39;ve always been in love with <a href="http://warpspire.com/posts/url-design/">beautiful URL design</a>. Specially for &#39;public&#39; parts of the site. In Rails, it&#39;s pretty common to use the ID of the object in the URL. Well, that <strong>really</strong> sucks.</p>

<p>My first approach to solve this problem was started by <a href="http://mheroin.com/">Federico Builes</a> a long time ago with a plugin (<a href="https://github.com/nhocki/make_permalink">which I now maintain</a> as a gem) called <a href="http://rubygems.org/gems/make_permalink">Make Permalink</a>. It&#39;s really easy to use and will (up to some point) solve the problem. I know <a href="http://rubygems.org/gems/friendly_id">FriendlyID</a> exists, but I <em>hate</em> having the permalink field in my database (I <em>always</em> forget it) so that&#39;s why I like Make Permalink&#39;s approach.</p>

<div><script src='https://gist.github.com/1660555.js?file=make_permalink_example.rb'></script>
<noscript><pre><code>class Post &lt; ActiveRecord::Base
  make_permalink :title

  # Override this method to have nice looking
  # URLs. You still use `Post.find` in the controller
  # and will get URL like this:
  #
  #    /posts/1-look-mom-i-rock
  def to_param
    permalink
  end
end
</code></pre></noscript></div>

<p>The good thing about having <code>/users/1-nhocki</code> as the URL is that is way better than <code>/users/1</code> <strong>AND</strong> you don&#39;t have to change any of your app for that (you can still use <code>find</code> in your controllers).</p>

<p>I was really glad with this but not too long ago, someone asked me for something similar but for Mongoid. And hell! Mongoid ids are ugly as shit! So, they wanted to have <em><strong>just</strong></em> the username. I said, well, why don&#39;t you just change the <code>to_param</code> method to return the username and use <code>User.find_by_username</code> everywhere?</p>

<p>Even though this actually works, I would be very tired from writing <code>find_by_username</code> over and over again. So I told him to write a <code>fetch</code> method where he could get an user either by the <code>id</code> or the <code>username</code>. I think this is pretty convenient and nice, but I would <em><strong>hate</strong></em> to write that fetch method in every model. So, with some metaprogramming we can easily do this.</p>

<p>First, I&#39;ve created a <code>fetchable_on</code> method to use it in your models. This will define a class method called <code>fetch</code> that will let you get the object by querying on the <code>attribute</code> <strong>OR</strong> on the <code>id</code>. Right now, it won&#39;t work if your attribute is a numeric value (like the number of bathrooms you have in your house), but most of the times, it&#39;s ok. Here&#39;s the code. Place it in your initializers folder.</p>

<div><script src='https://gist.github.com/1657758.js?file='></script>
<noscript><pre><code># config/initializers/fetchable.rb

# encoding: UTF-8

module Extensions
  module Fetchable
    # Adding `fetchable_on` to a model will define the `fetch` method
    # that will allow you to query that model with the `attribute` or `id`.
    #
    # Having the following:
    #
    #    class User &lt;&lt; ActiveRecord::Base
    #      fetchable_on :username
    #    end
    #
    # Will let you fetch users by username or id.
    #
    #    User.fetch('nhocki').id # =&gt; 1
    #    User.fetch(1).username # =&gt; nhocki
    def fetchable_on(attribute)
      define_singleton_method(&quot;fetch&quot;) do |*args|
        looked_value = args.shift
        begin
          find(looked_value.to_i, *args)
        rescue ActiveRecord::RecordNotFound
          send(&quot;find_by_#{attribute}!&quot;, looked_value.to_s, *args)
        end
      end
    end
  end
end

ActiveRecord::Base.extend(Extensions::Fetchable)</code></pre></noscript></div>

<p>That way, you just need to call <code>fetchable_on :attribute</code> in your model and it&#39;ll adjust the <code>fetch</code> method to query on that <code>attribute</code> or the <code>id</code>. Here&#39;s an example:</p>

<div><script src='https://gist.github.com/1660555.js?file=fetchable_example.rb'></script>
<noscript><pre><code>class User &lt; ActiveRecord::Base
  fetchable_on :username

  # URL Style: /users/nhocki
  def to_param
    username
  end
end

# Gives you the `fetch` method.
# It takes the username or the id.
# Use fetch in your controller

User.fetch('nhocki').id # =&gt; 1
User.fetch(1).username  # =&gt; 'nhocki'
</code></pre></noscript></div>

<p><strong>Note that I use <code>find_by_attribute!</code> to throw an exception if the object is not found. Using the method without a <code>!</code> will return <code>nil</code> if there&#39;s no object in the DB.</strong></p>

<p>How would you implement this? Any good solutions?</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/10/simple-presenters--decorators-on-rails/">Simple Presenters & Decorators on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-10T00:00:00-05:00" pubdate data-updated="true">Jan 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There&#39;s been a <a href="http://blog.steveklabnik.com/posts/2011-09-06-the-secret-to-rails-oo-design">lot</a> of <a href="http://blog.steveklabnik.com/posts/2011-09-09-better-ruby-presenters">talk</a> <a href="http://avdi.org/devblog/2011/11/15/early-access-beta-of-objects-on-rails-now-available-2/">about</a><a href="http://robots.thoughtbot.com/post/14825364877/evaluating-alternative-decorator-implementations-in">decorators</a> and <a href="http://robots.thoughtbot.com/post/13641910701/tidy-views-and-beyond-with-decorators">presenters</a> (<a href="https://groups.google.com/forum/#!msg/objects-on-rails/htAopf3k_dM/qJMq6QAfMvsJ">which are almost the same</a>) in Rails and how they help you with a &quot;real&quot; OO code. There are great gems and there&#39;s even a <a href="http://railscasts.com/episodes/287-presenters-from-scratch">Railscast</a> (pro) on how to build a presenter from scratch. But, in the new project I&#39;m working on, we (&lt;- <a href="https://github.com/febuiles">he</a>) has this <strong>really</strong> simple setup which I feel kind of cleaner.</p>

<p>What we wanted to have was a <code>present</code> method in the controller and build the view from its methods. So, we created an <a href="http://api.rubyonrails.org/classes/ActiveSupport/Concern.html">ActiveSupport::Concern</a> called <code>Presentable</code> and included it in our application controller. Here&#39;s our (once again, his) code for that module.</p>

<div><script src='https://gist.github.com/1592754.js?file=presentable.rb'></script>
<noscript><pre><code># app/concerns/controllers/presentable.rb

# Presentable Concern
# Include this module in the controllers where
# you need the `present` method.
module Presentable
  # This method returns a Presenter Object to work
  # with in the view.
  #
  # Attributes:
  #   object:   The object to present
  #
  # Supported Options
  #    as:   The presenter class. If this is not suplied 
  #          the method will try to guess the class
  #          e.g: UserPresenter for a User object.
  def present(object, options = { })
    if object.respond_to?(:first)
      return [] if object.empty?
      presenter = &quot;#{object.first.class.to_s.pluralize}Presenter&quot;
    else
      presenter = &quot;#{object.class}Presenter&quot;
    end

    presenter = options.fetch(:as) { eval(presenter) }
    presenter.new(object)
  end
end
</code></pre></noscript></div>

<p>Now, we just need to create each presenter. But, since there&#39;s a lot of shared logic between presenters we (he) just created a parent <code>Presenter class</code> with all that. Notice that our presenter takes an object as parameter, so we just delegated all the method calls to our record (thank you <code>method missing</code>) if it responded to that method. You could also send the view context to access Rails helpers inside your presenter. Here&#39;s our <code>Presenter base class</code>.</p>

<div><script src='https://gist.github.com/1592754.js?file=presenter.rb'></script>
<noscript><pre><code># Base presenter class
# All presenters should inherit from this one.
class Presenter
  # Include all the modules you need or
  # send the view context to access rails helpers.
  include Rails.application.routes.url_helpers
  # ...

  include Presentable

  attr_reader :record

  def initialize(record)
    @record = record
    @klass = record.class
  end

  def method_missing(name, *arguments, &amp;block)
    super unless record.respond_to?(name)
    record.send(name, *arguments, &amp;block)
  end

  def translate_field_name(name)
    @klass.human_attribute_name(name)
  end

  # UrlHelper was being an ass, easier to go commando.
  def link_to(name, url, options={})
    href = { :href =&gt; url }
    content_tag(:a, name, options.merge(href))
  end
end
</code></pre></noscript></div>

<p>Then, we just need to inherit from the <code>Presenter</code> class and add our custom, clean methods. Using <code>delegate and method missing</code> will help us keep the class clean. I won&#39;t show you a presenter here, they&#39;ll look a lot like Ryan&#39;s one in his Railscasts so check that out first.</p>

<p>I will show you our controller though. Using the decent_exposure gem we managed to get super tiny controllers. Here&#39;s 1 of them:</p>

<div><script src='https://gist.github.com/1592754.js?file=requests_controller.rb'></script>
<noscript><pre><code>class RequestsController &lt; ApplicationController
  expose(:filter) { params.fetch(:filter) { :all} }
  expose(:filtered_requests) { Request.filter(filter) }
  expose(:requests) { present(filtered_requests) }

  before_filter :find_request, :only =&gt; [:show, :destroy]

  def index
  end

  def show
    extend(RequestRedirector) # Another concern
    redirect_to_request
  end

  def destroy
    @request.destroy
    redirect_to requests_path(:filter =&gt; &quot;new_requests&quot;), :notice =&gt; &quot;Se ha eliminado la solicitud&quot;
  end

  private
  def find_request
    @request = Request.find(params[:id])
  end
end
</code></pre></noscript></div>

<p>Combining <code>presenters</code> and <code>form builders</code> will make your views even cleaner, giving a lot of pleasure to the future you! So please, just pretty-please, start using presenters and builders and leave helpers as simple as possible. Or, leave them for good.</p>

<p>You&#39;ll be amazed how different you&#39;ll feel when reading some old code or some co-worker&#39;s code.</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/06/but-free-web-services-are-not-like-free-software/">But Free Web Services Are Not Like Free Software</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-06T00:00:00-05:00" pubdate data-updated="true">Dec 6<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
<p>But free web services are not like free software. If your free software project suddenly gets popular, you gain resources: testers, developers and people willing to pitch in. If your free website takes off, you lose resources. Your time is spent firefighting and your money all goes to the nice people at Linode. </p>
</blockquote>

<p>Don&#39;t be a Free User - <a href="http://blog.pinboard.in/2011/12/don_t_be_a_free_user/">Pinboard Blog</a></p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/11/30/colorize-your-rake-output/">Colorize Your Rake Output</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-30T00:00:00-05:00" pubdate data-updated="true">Nov 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#39;ve been writing a lot of rake tasks lately. I like to have a lot of output (feedback) from my tasks, at least while I&#39;m writing them. I have colors in my tests, but my output is really ugly, so I took <a href="https://github.com/andmej/chatte/blob/master/client.rb#L15-24">some code</a> from <a href="https://github.com/andmej/chatte/">Chatte</a>, - a simple chat application a <a href="http://andr.esmejia.com/">friend</a> (and awesome <a href="https://github.com/andmej/">developer</a>, btw) wrote for college- and made some modifications for it. Here&#39;s my module right now…</p>

<div><script src='https://gist.github.com/1410582.js?file='></script>
<noscript><pre><code>module Colors
  def colorize(text, color_code)
    &quot;\033[#{color_code}m#{text}\033[0m&quot;
  end

  {
    :black    =&gt; 30,
    :red      =&gt; 31,
    :green    =&gt; 32,
    :yellow   =&gt; 33,
    :blue     =&gt; 34,
    :magenta  =&gt; 35,
    :cyan     =&gt; 36,
    :white    =&gt; 37
  }.each do |key, color_code|
    define_method key do |text|
      colorize(text, color_code)
    end
  end
end

# green &quot;Hello&quot;
#   =&gt; &quot;\e[32mHello\e[0m&quot;</code></pre></noscript></div>

<p>Now, you just need to <code>include Colors</code> in your tasks and enjoy your life.</p>

<p>I know there&#39;s a <a href="https://github.com/fazibear/colorize">colorize</a> gem out there, but I don&#39;t like their syntax. I prefer Andres&#39; approach much more, so maybe I&#39;ll turn this into a really simple gem. Do you think it&#39;s worth it?</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/11/09/algorithms-are-on-the-cutting-edge-of-entrepreneurship/">Algorithms Are on the Cutting Edge of Entrepreneurship.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-09T00:00:00-05:00" pubdate data-updated="true">Nov 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
<p>Algorithms are on the cutting edge of entrepreneurship. If you&#39;re talking
about just re-implementing stuff that people did ten years ago, performance
isn&#39;t that important at some level. But, if you&#39;re talking about doing stuff
that nobody has done before, one of the reasons often that they haven&#39;t done
it is because it&#39;s too time-consuming.</p>
</blockquote>

<p>By Charles Leiserson</p>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/09/28/compile-assets-and-push-them---no-pain-involved/">Compile Assets and Push Them - No Pain Involved!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-28T00:00:00-04:00" pubdate data-updated="true">Sep 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This week, I&#39;ve been working on a side project with <a href="http://andr.esmejia.com/">Andrés
Mejía</a> (<a href="http://twitter.com/andmej">@andmej</a>) and
for some really really sad reason <a href="http://heroku.com">Heroku</a> is not working
as expected (a simple git push should do the trick, but we&#39;re having a really
<a href="https://github.com/ddollar/rails_log_stdout/issues/4">weird issue</a>).</p>

<p>At first, I thought it had something to do with the assets. Even-though
<a href="http://heroku.com">Heroku</a> has <a href="h%0Attp://devcenter.heroku.com/articles/rails31_heroku_cedar#the_asset_pipeline">asset compiling tasks on their Cedar stack</a>,
it didn&#39;t really worked for us at first. So I just decided to create a small
rake task to compile the assets and push them to Github.</p>

<p>The good thing about this rake task is that it will only push the assets. This
means, that <strong>you&#39;ll need a clean git tree to run this task or it will die</strong>.
This ensures that the automatic push <strong>won&#39;t commit any non-related change to
the compilation of the assets</strong>.</p>

<p>Now, you only have to run <strong>rake assets:compile</strong> and sleep well at night.
Here&#39;s the code. Hope it helps.</p>

<div><script src='https://gist.github.com/1241135.js?file='></script>
<noscript><pre><code>namespace :assets do
  desc &quot;Compile all the assets named in config.assets.precompile and push them&quot;
  task :compile do
    AssetsCompiler.new.compile
  end

  class AssetsCompiler
    def compile
      ensure_clean_git
      removed_previous_assets
      compile_assets
      commit_compiled_assets
      push
    end

    def ensure_clean_git
      raise &quot;Can't deploy without a clean git status.&quot; if git_dirty?
    end

    def removed_previous_assets
      run &quot;bundle exec rake RAILS_ENV=production assets:clean&quot;
    end

    def compile_assets
      run &quot;bundle exec rake RAILS_ENV=production assets:precompile&quot;
    end

    def commit_compiled_assets
      run &quot;git add -u &amp;&amp; git add . &amp;&amp; git commit -am 'Compiled assets'&quot;
    end

    def push
      run &quot;git push&quot;
    end

    private

    def run(command)
      puts &quot;+ Running: #{command}&quot;
      puts &quot;-- #{system command}&quot;
    end

    def git_dirty?
      `[[ $(git diff --shortstat 2&gt; /dev/null | tail -n1) != &quot;&quot; ]]`
      dirty = $?.success?
    end
  end
end</code></pre></noscript></div>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/09/21/simple-scrollbar-synchronization-with-jquery/">Simple Scrollbar Synchronization With jQuery</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-09-21T00:00:00-04:00" pubdate data-updated="true">Sep 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#39;m working on a really cool project on my University. It&#39;s a web application
to compare book editions and help professors build what is know as the
Collatzio. The Collatzio is simply the &quot;original&quot; version of the book. That
means, to have the book the author wanted to write and not the one that the
editors wanted to publish.</p>

<p>I needed to have two versions of the book aligned side by side. So, the
HTML/CSS was pretty simple. Just have two simple divs with <strong>overflow-y:
auto;</strong> to make the scrollbar appears on each div.</p>

<p>The coffeescript code I used is really simple, here it is:</p>

<div><script src='https://gist.github.com/1233545.js?file='></script>
<noscript><pre><code>jQuery ($) -&gt;
  ($ &quot;.scroll-text&quot;).scroll (event) -&gt;
    trigger = ($ @)
    element = trigger.data(&quot;scrolls&quot;)
    $(element).scrollTop(trigger.scrollTop())
    event.preventDefault()
    return false</code></pre></noscript></div>

<p>Hope it helps someone. I struggled a little bit with the &quot;common&quot; way of
scrolling things. People usually use the <code>animate</code> method to scroll the body,
but I couldn&#39;t use it because it kept triggering the scroll event on the
elements, so it was an infinite loop.</p>
<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;html, body&quot;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">scrollTop</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span><span class="err"> </span><span class="s2">&quot;slow&quot;</span><span class="p">);</span>
</code></pre>
</div>
</div>
  
  


    </article>
  
  
    <article class='post'>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/08/26/timehub-the-first-winner/">TimeHub, the First Winner!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-26T00:00:00-04:00" pubdate data-updated="true">Aug 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just wanted to &quot;personally&quot; say thanks to everyone who voted for my entry on
the <a href="http://rallyonrails.com">Rally on Rails</a> (Latinamerican Rails Rumble).</p>

<p><a href="http://timehub.net">Timehub</a> won! And this couldn&#39;t be possible without the
people who voted.</p>

<p>I would like to thank the Rally on Rails team &amp; judges. They made an excellent
job and even though there are somethings to improve (like the voting rules),
<strong>I think that the contest was great!</strong></p>

<p>We had already posted a &quot;<a href="http://blog.timehub.net/post/9404894926/from-medellin-with-love">thank you
note</a>&quot;, in
the <a href="http://timehub.net">Timehub</a> blog, but I really wanted to write one
myself.</p>

<p>I was pretty spammer during these last 3 days! That will stop now!</p>

<p><strong>Thanks again!</strong> Hope to see you in <a href="http://timehub.net">Timehub</a> v2!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev float-left" href="/blog/page/3/">&larr; Older</a>
    

    
    <a class="next float-right" href="/">Newer &rarr;</a>
    
    <div class='clear'></div>
  </div>
</div>
  </div>
  <footer role="contentinfo"><div id='archive' class='centered'>
  <h1><a href="/blog/archives">Blog Archives</a></h1>
</div>

<p class="site-end-note">
  You can follow me on Twitter <a href="https://twitter.com/nhocki">@nhocki</a>,
  find me on Github as <a href="https://github.com/nhocki">nhocki</a> or
  write me an email at <a href="mailto:nhocki@gmail.com">nhocki@gmail.com</a>
</p>

<p class="site-end-note">You should also suscribe to my <a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS Feed</a></p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
