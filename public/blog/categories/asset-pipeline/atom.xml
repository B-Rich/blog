<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: asset-pipeline | Nicolás Hock Isaza]]></title>
  <link href="http://blog.nhocki.com/blog/categories/asset-pipeline/atom.xml" rel="self"/>
  <link href="http://blog.nhocki.com/"/>
  <updated>2013-03-07T21:27:29-05:00</updated>
  <id>http://blog.nhocki.com/</id>
  <author>
    <name><![CDATA[Nicolás Hock Isaza]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Compile assets and push them - no pain involved!]]></title>
    <link href="http://blog.nhocki.com/2011/09/28/compile-assets-and-push-them---no-pain-involved/"/>
    <updated>2011-09-28T00:00:00-04:00</updated>
    <id>http://blog.nhocki.com/2011/09/28/compile-assets-and-push-them---no-pain-involved</id>
    <content type="html"><![CDATA[<p>This week, I&#39;ve been working on a side project with <a href="http://andr.esmejia.com/">Andrés
Mejía</a> (<a href="http://twitter.com/andmej">@andmej</a>) and
for some really really sad reason <a href="http://heroku.com">Heroku</a> is not working
as expected (a simple git push should do the trick, but we&#39;re having a really
<a href="https://github.com/ddollar/rails_log_stdout/issues/4">weird issue</a>).</p>

<p>At first, I thought it had something to do with the assets. Even-though
<a href="http://heroku.com">Heroku</a> has <a href="h%0Attp://devcenter.heroku.com/articles/rails31_heroku_cedar#the_asset_pipeline">asset compiling tasks on their Cedar stack</a>,
it didn&#39;t really worked for us at first. So I just decided to create a small
rake task to compile the assets and push them to Github.</p>

<p>The good thing about this rake task is that it will only push the assets. This
means, that <strong>you&#39;ll need a clean git tree to run this task or it will die</strong>.
This ensures that the automatic push <strong>won&#39;t commit any non-related change to
the compilation of the assets</strong>.</p>

<p>Now, you only have to run <strong>rake assets:compile</strong> and sleep well at night.
Here&#39;s the code. Hope it helps.</p>

<p><div><script src='https://gist.github.com/1241135.js?file='></script>
<noscript><pre><code>namespace :assets do
  desc &quot;Compile all the assets named in config.assets.precompile and push them&quot;
  task :compile do
    AssetsCompiler.new.compile
  end

  class AssetsCompiler
    def compile
      ensure_clean_git
      removed_previous_assets
      compile_assets
      commit_compiled_assets
      push
    end

    def ensure_clean_git
      raise &quot;Can't deploy without a clean git status.&quot; if git_dirty?
    end

    def removed_previous_assets
      run &quot;bundle exec rake RAILS_ENV=production assets:clean&quot;
    end

    def compile_assets
      run &quot;bundle exec rake RAILS_ENV=production assets:precompile&quot;
    end

    def commit_compiled_assets
      run &quot;git add -u &amp;&amp; git add . &amp;&amp; git commit -am 'Compiled assets'&quot;
    end

    def push
      run &quot;git push&quot;
    end

    private

    def run(command)
      puts &quot;+ Running: #{command}&quot;
      puts &quot;-- #{system command}&quot;
    end

    def git_dirty?
      `[[ $(git diff --shortstat 2&gt; /dev/null | tail -n1) != &quot;&quot; ]]`
      dirty = $?.success?
    end
  end
end</code></pre></noscript></div>
</p>
]]></content>
  </entry>
  
</feed>
