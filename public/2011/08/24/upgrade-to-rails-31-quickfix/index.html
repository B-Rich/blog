
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Upgrade to Rails 3.1 Quickfix - Nicol치s Hock Isaza</title>
  <meta name="author" content="Nicol치s Hock Isaza">

  
  <meta name="description" content="In case you missed it, Rails 3.1 is out! So please, stop using the release candidates and update now! Short Version; TL;DR If you&#8217;re can&#8217; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.nhocki.com/2011/08/24/upgrade-to-rails-31-quickfix">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Nicol치s Hock Isaza" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25223573-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <header role="banner"><hgroup>
  <h1><a href="/">Nicol치s Hock Isaza</a></h1>
  
    <h2>Ruby, Rails, Programming and Random Thoughts</h2>
  
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Upgrade to Rails 3.1 Quickfix</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-08-24T00:00:00-04:00" pubdate data-updated="true">Aug 24<span>th</span>, 2011</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In case you missed it, <a href="http://guides.rubyonrails.org/3_1_release_notes.html">Rails 3.1 is out</a>! So please, stop using the release candidates and update now!</p>

<p><strong>Short Version; TL;DR</strong></p>

<p><strong>If you&#8217;re can&#8217;t see your images in your production environment, add this to your <code>production.rb</code> file</strong></p>

<div><script src='https://gist.github.com/1185431.js?file='></script>
<noscript><pre><code># Capistrano task to compile assets
# Make sure that you have `config.assets.compile = true` in production.rb when running this
# This (the `compile=true`) won't be needed for Rails 3.1.1

desc &quot;Precompile assets on production&quot;
task :assets do
  run &quot;cd #{release_path}; RAILS_ENV=production bundle exec rake assets:clean&quot;
  run &quot;cd #{release_path}; RAILS_ENV=production bundle exec rake assets:precompile&quot;
end</code></pre></noscript></div>


<p>Yesterday, I was updating <a href="http://timehub.net">Timehub</a> to Rails 3.1, we had a rails3.1 branch and we were just waiting for the official version to change it.</p>

<p>As soon as I got home from the <a href="http://coffeegrid.org/">Coffee Grid</a> meetup (where we talked about Timehub), I decided to update it. What could possibly go wrong? We&#8217;ve been using a release candidate with <strong>no more than 3 days old</strong> and it was working just fine.</p>

<p>We changed our <code>Gemfile</code> and started to use Rails 3.1. We tested the app on development and everything was working as expected, so I just relaxed while deploying.</p>

<p>I <strong>always</strong> look at the server after a deploy, and to my surprise, <strong>no images where shown in the production environment</strong>. WTF? We were compiling our assets (with a small Capistrano task).</p>

<p>We watched the source of the page and instantly found the problem. The server was not looking for the images with the MD5 digest at the end. This was REALLY weird because we were using <code>image_tag</code> everywhere so we shouldn&#8217;t care about it!</p>

<p>This means that the server was looking for <code>/assets/rails.png</code> instead of
<code>/assets/rails-3289328982JAKSDJK.png</code></p>

<p>I looked to the awesome <a href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipeline Guide</a>, I asked around with Twitter, I restarted the server several times. I did everything and nothing worked until <a href="https://twitter.com/#!/guilleiguaran">@guilleiguaran </a>gave me the answer on twitter!</p>

<p>You simply need to add those 2 lines to fix your assets (look up if you missed it!)</p>

<p>The problem is that it wasn&#8217;t really documented and that the release candidates didn&#8217;t have that! So it was <strong>REALLY</strong> hard to guess. Actually, I think @guilleiguaran knew because he made those changes!</p>

<p>After that, we could easily update and now we&#8217;re 100% on Rails 3.1!</p>

<p>Hope this helps you too!</p>
</div>


  <footer>
    <p class="meta">
      

<span class="categories">
  Posted under: 
  
    <a class='category' href='/blog/categories/patches/'>patches</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/tips/'>tips</a>
  
</span>


    </p>
    <p class="meta posts">
      
        <a class="basic-alignment left" href="/2011/08/24/timehub-48-hours-after/" title="Previous Post: TimeHub 48 hours after">&laquo; TimeHub 48 hours after</a>
      
      
        <a class="basic-alignment right" href="/2011/08/26/timehub-the-first-winner/" title="next Post: TimeHub, the first winner!">TimeHub, the first winner! &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

    </div>
  </div>
  <footer role="contentinfo"><p class="site-end-note">
  You can follow me on Twitter <a href="https://twitter.com/nhocki">@nhocki</a>,
  find me on Github as <a href="https://github.com/nhocki">nhocki</a> or
  write me an email at <a href="mailto:nhocki@gmail.com">nhocki@gmail.com</a>
</p>

<p class="site-end-note">You should also suscribe to my <a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS Feed</a></p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nhocki';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.nhocki.com/2011/08/24/upgrade-to-rails-31-quickfix/';
        var disqus_url = 'http://blog.nhocki.com/2011/08/24/upgrade-to-rails-31-quickfix/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
